<!DOCTYPE html>
<html lang="pl">

<head>
    <link rel="icon" href="/fangea/local/fangeapage.png" type="image/png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edytor - Fangea i inne kontynenty</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
    <script src="https://kit.fontawesome.com/533593bc84.js" crossorigin="anonymous"></script>
    <style>
        @keyframes logo-entrance {
            from{
            transform: translate(-50%, -50%) scale(2);
            filter: blur(3px);
            opacity: 0;
            }
            to{
            transform: translate(-50%, -50%) scale(1);
            filter: blur(0);
            opacity: 1;      
            }
        }

    </style>
</head>

<body>
    <main class="article-editor">
        <div id="mobile-device-message">Edytor nie wspiera urządzeń mobilnych</div>
        <div id="editor-container">
            <a id="exit-editor" title="Strona Główna" href="https://grumqy.github.io/fangea/"><i class="fa-solid fa-house"></i></a>
            <div class="toolbar">
                <div class="toolbar-button" title="Wytłuszczenie">
                    <span class="bold tool-icon"></span>
                </div>
                <div class="toolbar-button" title="Kursywa">
                    <span class="italic tool-icon"></span>
                </div>
                <div class="toolbar-button" title="Wstaw link">
                    <span class="link tool-icon"></span>
                </div>
                <div class="toolbar-button" title="Wstaw zdjęcie">
                    <span class="image tool-icon"></span>
                </div>
                <div class="toolbar-tab-button" data-tab="advanced">Zaawansowane</div>
                <div class="toolbar-tab-button" data-tab="special-characters">Znaki Specjalne</div>
                <div class="toolbar-tab-button" data-tab="help">Pomoc</div>
                <div id="switch-preview"><i class="fa-solid fa-eye-slash"></i>Ukryj podgląd</div>
            </div>
            <div class="editor-tab advanced">
                <div class="toolbar-button" title="Wstaw listę numerowaną">
                    <span class="ol tool-icon"></span>
                </div>
                <div class="toolbar-button" title="Wstaw listę punktowaną">
                    <span class="ul tool-icon"></span>
                </div>
                <div class="toolbar-button ui" title="indeks górny">
                    <span class="ui tool-icon"></span>
                </div>
                <div class="toolbar-button li" title="indeks dolny">
                    <span class="li tool-icon"></span>
                </div>
                <div class="toolbar-button" title="Wstaw przekierowanie">
                    <span class="rd tool-icon"></span>
                </div>
                <div class="toolbar-button-select-container" style="padding-left: 0;">
                    <div class="toolbar-button" title="Wstaw tabelę">
                        <span class="table tool-icon"></span>
                    </div>
                    <div class="toolbar-button-select" id="table-setup">
                        <h3>Wstaw tabelę</h3>
                        <div>
                            <span>Ilość wierszy:</span><input id="rows-amount" type="number" min="2" value="3">
                        </div>
                        <div>
                            <span>Ilość kolumn:</span><input id="columns-amount" type="number" min="2" value="3">
                        </div>
                        <div>
                            <span>Treść nagłówków</span><input id="heading-content" type="text" value="nagłówek">
                        </div>
                        <div>
                            <span>Treść komórek</span><input id="cell-content" type="text" value="komórka">
                        </div>
                        <div>
                            <span>Kolumna nagłówków</span><input id="add-heading-column" type="checkbox">
                        </div>
                        <div>
                            <span>Wiersz nagłówków</span><input id="add-heading-row" type="checkbox" checked>
                        </div>
                    </div>
                </div>
                <div class="toolbar-button-select-container">
                    Nagłówek
                    <div class="toolbar-button-select">
                        <div class="toolbar-button" title="Wstaw rozdział"><h1>Nagłówek 1</h1></div>
                        <div class="toolbar-button" title="Wstaw śródtytuł"><h2>Nagłówek 2</h2></div>
                    </div>
                </div>
                <div class="toolbar-button-select-container">
                    Ikona
                    <div class="toolbar-button-select">
                        <div class="toolbar-button" title="Wstaw ikonę małą"><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon small"> mała</div>
                        <div class="toolbar-button" title="Wstaw ikonę średnią"><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon medium"> średnia</div>
                        <div class="toolbar-button" title="Wstaw ikonę dużą"><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon large"> duża</div>
                    </div>
                </div>
            </div>
            <div class="editor-tab special-characters">
                <div class="toolbar-button" title="Wstaw półpauzę">
                    <span>–</span>
                </div>
                <div class="toolbar-button" title="Wstaw punktor">
                    <span>•</span>
                </div>
                <div class="toolbar-button" title="Wstaw cudzysłów otwierający">
                    <span>„</span>
                </div>
                <div class="toolbar-button" title="Wstaw cudzysłów zamykający">
                    <span>”</span>
                </div>
                <div class="toolbar-button" title="Wstaw francuski cudzysłów otwierający">
                    <span>«</span>
                </div>
                <div class="toolbar-button" title="Wstaw francuski cudzysłów zamykający">
                    <span>»</span>
                </div>
            </div>
            <div class="editor-tab help">
                <table class="help">
                    <tr>
                        <th>Opis</th>
                        <th>Należy wpisać</th>
                        <th>Aby uzyskać</th>
                    </tr>
                    <tr>
                        <td>Nagłówek 1</td>
                        <td>= Treść Nagłówka =</td>
                        <td><h1>Treść nagłówka</h1></td>
                    </tr>
                    <tr>
                        <td>Nagłówek 2</td>
                        <td>== Treść Nagłówka ==</td>
                        <td><h2>Treść nagłówka</h2></td>
                    </tr>
                    <tr>
                        <td>Lista punktowana</td>
                        <td>
                            * Element listy<br>
                            * Element listy
                            </td>
                        <td><ul><li>Element listy</li><li>Element listy</li></ul></td>
                    </tr>
                    <tr>
                        <td>Lista numerowana</td>
                        <td>
                            # Element listy<br>
                            # Element listy
                            </td>
                        <td><ol><li>Element listy</li><li>Element listy</li></ol></td>
                    </tr>
                    <tr>
                        <td>Hiperłącze</td>
                        <td>(https://grumqy.github.io/fangea/wiki/cartland/)[Cartland]</td>
                        <td><a href="https://grumqy.github.io/fangea/wiki/cartland/">Cartland</a></td>
                    </tr>
                    <tr>
                        <td>Kursywa</td>
                        <td>''Kursywa''</td>
                        <td><i>Kursywa</i></td>
                    </tr>
                    <tr>
                        <td>Wytłuszczenie</td>
                        <td>'''Wytłuszczenie'''</td>
                        <td><b>Wytłuszczenie</b></td>
                    </tr>
                    <tr>
                        <td>Wytłuszczona kursywa</td>
                        <td>'''''Wytłuszczona kursywa'''''</td>
                        <td><i><b>Wytłuszczona kursywa</b></i></td>
                    </tr>
                    <tr>
                        <td>Zdjęcie<br>
                        <i><b>Parametr 2</b> (left/right) oznacza ustawienie zdjecia w artykule.</i></td>
                        <td>[[img:http://via.placeholder.com/640x360|left|Opis zdjęcia]]</td>
                        <td>
                        <figure>
                            <img src="http://via.placeholder.com/640x360" />
                            <figcaption>
                                Opis zdjęcia
                            </figcaption>
                        </figure>
                        </td>
                    </tr>
                    <tr>
                        <td>Ikona mała</td>
                        <td>[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|small]]</td>
                        <td><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon">Lorem ipsum</td>
                    </tr>
                    <tr>
                        <td>Ikona średnia</td>
                        <td>[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|medium]]</td>
                        <td><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon medium">Lorem ipsum</td>
                    </tr>
                    <tr>
                        <td>Ikona duża</td>
                        <td>[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|large]]</td>
                        <td><img src="https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png" class="icon large">Lorem ipsum</td>
                    </tr>
                    <tr>
                        <td>Tabela<br>
                        <i style="font-size: 0.5rem; line-height: 0.3rem;"><b>Scalenie:</b><br>
                        |c=2 podwójna komórka |<br>
                        <b>Wyśrodkowany tekst:</b><br>
                        |t=c wyśrodkowana komórka |<br>
                        <b>Scalenie i wyśrodkowanie:</b><br>
                        |t=cc=2 wyśrodkowana i scalona komórka |
                        </i>
                        </td>
                        <td style="font-size: 0.7rem;">{|<br>
                                ! Nagłówek !! Nagłówek !! Nagłówek !<br>
                                | komórka || komórka || komórka |<br>
                                | komórka || komórka || komórka |<br>
                                | komórka || komórka || komórka |<br>
                                |}
                        <td>
                            <table class="help-table">
                                <tr><th>Nagłówek</th><th>Nagłówek</th><th>Nagłówek</th></tr>
                                <tr><td>komórka</td><td>komórka</td><td>komórka</td></tr>
                                <tr><td>komórka</td><td>komórka</td><td>komórka</td></tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td>Tabela Infobox</td>
                        <td style="font-size: 0.7rem;">
                            {|infobox Port Złotice<br>
                            !t=cc=2 miasto i gmina !<br>
                            |c=2 [[timg:https://i.ibb.co/VNZHWQ0/image.png|Panorama miasta]] |<br>
                            |{ibox<br>
                            | [[timg:https://i.ibb.co/RBRPbgD/image.png|Flaga miasta]] || [[timg:https://i.ibb.co/ZcJ2kCT/image.png|herb miasta]] |<br>
                            |t=c Flaga || t=c herb |<br>
                            }|<br>
                            ! Państwo !| [[icon:https://i.ibb.co/qyDFLK9/image.png|small]] Zjednoczone Królestwo Pieczarek |<br>
                            ! Województwo !| [[icon:https://i.ibb.co/RBRPbgD/image.png|small]] Złotickie |<br>
                            ! Data założenia !| 1 września 2022 |<br>
                            ! Prawa miejskie !| 1 września 2022 |<br>
                            ! Burmistrz !| Mikołaj Bniewski |<br>
                            ! Liczba ludności !| 10 293 mieszkańców |<br>
                            ! Kod pocztowy !| 02-001 |<br>
                            ! Tablice rejestracyjne !| PZ |<br>
                            |}<br>
                        </td>
                        <td>
                            <table class="infobox help" style="width: 100%; max-width: 100%; margin: 0;">
                                <caption>
                                    Port Złotice
                                </caption>
                                <tbody>
                                    <tr class="center">
                                        <th colspan="2">
                                            miasto i gmina
                                        </th>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <img data-description="Panorama miasta" src="https://i.ibb.co/VNZHWQ0/image.png" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <table class="ibox">
                                                <tbody>
                                                    <tr>
                                                        <td style="width: 60%; vertical-align: middle">
                                                            <img data-description="Flaga miasta Port Złotice" src="https://i.ibb.co/RBRPbgD/image.png" />
                                                        </td>
                                                        <td>
                                                            <img data-description="Herb miasta Port Złotice" src="https://i.ibb.co/ZcJ2kCT/image.png" />
                                                        </td>
                                                    </tr>
                                                    <tr class="center">
                                                        <td>Flaga</td>
                                                        <td style="font-family: 'montserrat'; font-size: 0.85rem;">Herb</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Państwo</th>
                                        <td><img class="icon small" src="https://i.ibb.co/qyDFLK9/image.png"> Zjednoczone Królestwo Pieczarek</td>
                                    </tr>
                                    <tr>
                                        <th>Województwo</th>
                                        <td><img class="icon small" src="https://i.ibb.co/RBRPbgD/image.png"> Złotickie</td>
                                    </tr>
                                    <tr>
                                        <th>Data założenia</th>
                                        <td>1 września 2022</td>
                                    </tr>
                                    <tr>
                                        <th>Prawa miejskie</th>
                                        <td>1 września 2022</td>
                                    </tr>
                                    <tr>
                                        <th>Burmistrz</th>
                                        <td>Mikołaj Bniewski</td>
                                    </tr>
                                    <tr>
                                        <th>Liczba ludności</th>
                                        <td>10 293 mieszkańców</td>
                                    </tr>
                                    <tr>
                                        <th>Kod pocztowy</th>
                                        <td>02-001</td>
                                    </tr>
                                    <tr>
                                        <th>Tablice rejestracyjne</th>
                                        <td>PZ</td>
                                    </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
            <textarea id="editor" spellcheck="false"></textarea>
            <div id="title-input-container"><span>Tytuł: </span><input id="article-title" value="Tytuł Artykułu" type="text"><span>Data: </span><input id="article-date" value="DD.MM.YYYY" readonly type="text"><span id="update-preview-button"><i class="fa-solid fa-arrow-rotate-right"></i></span></div>
            <div id="save-container">
                <div style="display: flex; align-items: center; margin-right: auto; margin-left: 1rem;">
                    <label for="include-dictionary" style="padding-right: 0.5rem; user-select: none; cursor: pointer;">Słownik</label>
                    <input type="checkbox" id="include-dictionary" style="cursor: pointer;">
                    <span id="dictionary-error-message"></span>
                </div>
                <div id="save-article"><i class="fa-solid fa-clipboard"></i> Skopiuj do schowka</div>
            </div>
            <div id="dictionary-setup" class="hidden">
                <div id="dictionary-tab-bar">
                    <div data-tab="pronunciation" class="active">Wymowa</div>
                    <div data-tab="meanings">Znaczenia</div>
                    <div data-tab="inflection">Odmiana</div>
                    <div data-tab="related">Wyrazy Pokrewne</div>
                    <div data-tab="translation">Tłumaczenie</div>
                    <div data-tab="etymology">Etymologia</div>
                </div>
                <div id="dictionary-tabs">
                    <div id="pronunciation" class="active">
                        <div class="content">
                            <h2>wymowa</h2>
                            <input type="text">
                        </div>
                    </div>
                    <div id="meanings">
                        <div class="content">
                            <h2>znaczenia</h2>
                            <div class="list-type-input-list">
                                <div class="list-type-input-container">
                                    <input type="text" class="list-type-input">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="inflection">
                        <div class="content">
                            <h2>odmiana</h2>
                            <table class="inflection-table">
                            <tbody><tr>
                                <th>przypadek</th>
                                <th>liczba pojedyncza</th>
                                <th class="inflection-lm">liczba mnoga</th>
                            </tr>
                            <tr>
                                <th>mianownik</th>
                                <td><input type="text" id="mianownik-lp"></td>
                                <td class="inflection-lm"><input type="text" id="mianownik-lm"></td>
                            </tr>
                            <tr>
                                <th>dopełniacz</th>
                                <td><input type="text" id="dopelniacz-lp"></td>
                                <td class="inflection-lm"><input type="text" id="dopelniacz-lm"></td>
                            </tr>
                            <tr>
                                <th>celownik</th>
                                <td><input type="text" id="celownik-lp"></td>
                                <td class="inflection-lm"><input type="text" id="celownik-lm"></td>
                            </tr>
                            <tr>
                                <th>biernik</th>
                                <td><input type="text" id="biernik-lp"></td>
                                <td class="inflection-lm"><input type="text" id="biernik-lm"></td>
                            </tr>
                            <tr>
                                <th>narzędnik</th>
                                <td><input type="text" id="narzednik-lp"></td>
                                <td class="inflection-lm"><input type="text" id="narzednik-lm"></td>
                            </tr>
                            <tr>
                                <th>miejscownik</th>
                                <td><input type="text" id="miejscownik-lp"></td>
                                <td class="inflection-lm"><input type="text" id="miejscownik-lm"></td>
                            </tr>
                            <tr>
                                <th>wołacz</th>
                                <td><input type="text" id="wolacz-lp"></td>
                                <td class="inflection-lm"><input type="text" id="wolacz-lm"></td>
                            </tr>
                        </tbody>
                    </table>
                        </div>
                    </div>
                    <div id="related">
                        <div class="content">
                            <h2>wyrazy pokrewne</h2>
                            <div class="list-type-input-list">
                                <div class="list-type-input-container">
                                    <input type="text" class="list-type-input">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="translation">
                        <div class="content">
                            <h2>tłumaczenia</h2>
                            <div class="list-type-input-list">
                                <div class="list-type-input-container">
                                    <input type="text" class="list-type-input">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="etymology">
                        <div class="content">
                            <h2>Etymologia</h2>
                            <textarea spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="preview-container">
            <div id="modal-container">
                <div id="modal-overlay"></div>
            </div>
            <div id="preview-loading-container">
            </div>
            <article>
                <header>
                    <div>Tytuł Artykułu</div>
                    <span>14.06.2024</span>
                </header>
            </article>
        </div>
    </main>
    <script>
            document.getElementById("article-date").value = new Date().toLocaleDateString('en-GB').replace(/\//g, '.');
            const tabButtons = document.querySelectorAll('.toolbar-tab-button');
            const tabs = document.querySelectorAll('.editor-tab');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabToShow = this.getAttribute('data-tab');
                    const tabElement = document.querySelector(`.editor-tab.${tabToShow}`);
                    if (this.classList.contains('active')) {
                        this.classList.remove('active');
                        tabElement.classList.remove('active');
                    } else {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabs.forEach(tab => tab.classList.remove('active'));
                        this.classList.add('active');
                        tabElement.classList.add('active');
                    }
                });
            });
            const toolbarButtons = document.querySelectorAll('.toolbar-button');

            const linkTemplate = '(https://grumqy.github.io/fangea/wiki/edytor/)[Cartland]';
            const imageTemplate = '[[img:http://via.placeholder.com/640x360|left|Opis zdjęcia]]';
            const iconSmallTemplate = '[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|small]]';
            const iconMediumTemplate = '[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|medium]]';
            const iconLargeTemplate = '[[icon:https://i.ibb.co/Bz0Y2p1/bruktodyn-herb.png|large]]';
            const headingTemplate = `= Rozdział =`;
            const subheadingTemplate = `== Śródtytuł ==`;
            const bulletedListTemplate = `\n* List Item \n* List item \n* List item\n`;
            const numberedListTemplate = `\n# List Item \n# List item \n# List item\n`;
            const redirectionTemplate = `\n[[icon:https://i.ibb.co/vh0tWkb/informacja.png|medium]] ''Osobne Artykuły: (https://grumqy.github.io/fangea/wiki/edytor/)[Pierwszy artykuł] i (https://grumqy.github.io/fangea/wiki/edytor/)[Drugi artykuł]''\n`;
            let tableTemplate = `\n{|\n! Nagłówek !! Nagłówek !! Nagłówek !\n| komórka || komórka || komórka |\n| komórka || komórka || komórka |\n| komórka || komórka || komórka |\n|}\n`;

            function updateTableTemplate(){
            const rowsAmount = document.getElementById('rows-amount').value; 
            const columnsAmount = document.getElementById('columns-amount').value; 
            const cellContent = document.getElementById('cell-content').value; 
            const headingContent = document.getElementById('heading-content').value; 
            const addHeadingColumn = document.getElementById('add-heading-column').checked; 
            const addHeadingRow = document.getElementById('add-heading-row').checked; 

            var cell = `| ${cellContent} |`;
            var heading = `! ${headingContent} !`;
            tableTemplate = ``;
            var row = '';

            if(addHeadingColumn == true){
            row = heading;
            }

            for(i=0; i< columnsAmount; i++){
            row += cell;
            }
            row += '\n';

            
            if(addHeadingRow == true){
            for(i=0; i< columnsAmount; i++){
            tableTemplate += heading;
            }
            if(addHeadingColumn == true){
            tableTemplate += heading;
            }
            tableTemplate += '\n';
            }

            for(i=0; i< rowsAmount; i++){
                tableTemplate += row;
            }

            tableTemplate = `{|\n${tableTemplate}|}`;

            }

            function closeParentSelect(element){
                element.parentElement.style.display = 'none';
                setTimeout(function(){
                    element.parentElement.style.display = '';
                }, 50)
            }


        toolbarButtons.forEach(function(button) {
    button.addEventListener('click', function() {
        const title = button.getAttribute('title');
        switch (title) {
            case 'Wytłuszczenie': formatText("'''");; break;
            case 'Kursywa': formatText("''"); break;
            case 'Wstaw link': insertTemplate(linkTemplate, true); break;
            case 'Wstaw zdjęcie': insertTemplate(imageTemplate, true); break;
            case 'Wstaw rozdział': insertTemplate(headingTemplate, true); closeParentSelect(button); break;
            case 'Wstaw śródtytuł': insertTemplate(subheadingTemplate, true); closeParentSelect(button); break;
            case 'Wstaw listę numerowaną': insertTemplate(numberedListTemplate, true); break;
            case 'Wstaw listę punktowaną': insertTemplate(bulletedListTemplate, true); break;
            case 'Wstaw tabelę': updateTableTemplate(); insertTemplate(tableTemplate); break;
            case 'indeks górny': superscript(); break;
            case 'indeks dolny': subscript(); break;
            case 'Wstaw ikonę małą': insertTemplate(iconSmallTemplate, true); closeParentSelect(button); break;
            case 'Wstaw ikonę średnią': insertTemplate(iconMediumTemplate, true); closeParentSelect(button); break;
            case 'Wstaw ikonę dużą': insertTemplate(iconLargeTemplate, true); closeParentSelect(button); break;
            case 'Wstaw przekierowanie': insertTemplate(redirectionTemplate); break;
            case 'Wstaw półpauzę': insertTemplate('–'); break;
            case 'Wstaw punktor': insertTemplate('•'); break;
            case 'Wstaw cudzysłów otwierający': insertTemplate('„', true); break;
            case 'Wstaw cudzysłów zamykający': insertTemplate('”', true); break;
            case 'Wstaw francuski cudzysłów otwierający': insertTemplate('«', true); break;
            case 'Wstaw francuski cudzysłów zamykający': insertTemplate('»', true); break;
            default: break;
        }
    });
});

let includeDictionary = false;

const textarea = document.getElementById('editor');
textarea.value = `= Rozdział =

{|infobox Tytuł
|c=2 [[timg:http://via.placeholder.com/640x360|Opis zdjęcia]] |
|t=cc=2 Podpis zdjęcia |
|{ibox
|[[timg:http://via.placeholder.com/195x135|Opis zdjęcia]] || [[timg:http://via.placeholder.com/135x150|Opis zdjęcia]] |
|t=c Podpis 1 ||t=c Podpis 2 |
}|
! Informacja!| [[icon:http://via.placeholder.com/35x25|small]] Wartość z ikonką |
! Informacja !| Wartość |
! Informacja !| Wartość |
!t=cc=2 Nagłówek !
! Informacja !| Wartość |
! Informacja !| Wartość |
|}

[[img:http://via.placeholder.com/640x360|left|Opis zdjęcia]]

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

== Śródtytuł ==

Lorem ipsum dolor sit amet, (https://grumqy.github.io/fangea/)[strona główna] consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

* Element listy
* Element listy
* Element listy
* Element listy

= Rozdział =

[[img:http://via.placeholder.com/640x360|right|Opis zdjęcia]]

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.


{|
! nagłówek !! nagłówek !! nagłówek !
| komórka || komórka || komórka |
| komórka || komórka || komórka |
| komórka || komórka || komórka |
|}

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

`
updatePreview();

const article = document.querySelector('#preview-container article');

function formatText(format) {
    if (textarea.selectionStart !== textarea.selectionEnd) {
        textarea.value = textarea.value.substring(0, textarea.selectionStart) + format + textarea.value.substring(textarea.selectionStart, textarea.selectionEnd) + format + textarea.value.substring(textarea.selectionEnd);
        updatePreview();
    }
}

function insertTemplate(insertionTemplate, dynamicInsertion) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;

    if (start === end) {
        // No text is selected
        if (start != textarea.value.length) {
            // Insert template at the specific place
            textarea.value = textarea.value.substring(0, start) + insertionTemplate + textarea.value.substring(end, textarea.value.length);
        } else {
            // Append template to the end
            textarea.value += insertionTemplate;
            textarea.focus();
            textarea.scrollTop = textarea.scrollHeight;
        }
    } else {
        // Text is selected
        if (dynamicInsertion) {
            // Wrap selected text inside the template
            const initialScrollPosition = textarea.scrollTop;
            const selectedText = textarea.value.substring(start, end);
            const dynamicTemplate = getDynamicTemplate(insertionTemplate, selectedText);  // You need to define getDynamicTemplate function
            textarea.value = textarea.value.substring(0, start) + dynamicTemplate + textarea.value.substring(end, textarea.value.length);
            textarea.focus();
            textarea.selectionStart = start;
            textarea.selectionEnd = start + dynamicTemplate.length;
            textarea.scrollTop = initialScrollPosition;
        } else {
            // Replace selected text with the template
            textarea.value = textarea.value.substring(0, start) + insertionTemplate + textarea.value.substring(end, textarea.value.length);
        }
    }

    updatePreview();
}

function getDynamicTemplate(template, selectedText) {

    function dynamicList(listType){
    if(listType == 'bulleted'){
    var listSymbol = '*';
    }
    else if(listType == 'numbered'){
    var listSymbol = '#';
    }
    var result = [];
    var lines = selectedText.trim().split('\n');
    lines.forEach(line=>{
    result.push(`${listSymbol} ${line}`);
    })
    return result.join('\n');
    }
    // Define specific template functions for different template kinds
    // For example, if the template kind is bold, italic, etc.
    // This function should return the template with the selectedText inserted appropriately

    switch(template) {
        case linkTemplate:
            return `(https://grumqy.github.io/fangea/wiki/edytor/)[${selectedText}]`;
        case imageTemplate:
            return `[[img:${selectedText}|left|Opis zdjęcia]]`;
        case bulletedListTemplate:
            return dynamicList('bulleted');
        case numberedListTemplate:
            return dynamicList('numbered');
        case headingTemplate:
            return `= ${selectedText} =`;
        case subheadingTemplate:
            return `== ${selectedText} ==`;
        case iconSmallTemplate:
            return `[[icon:${selectedText}|small]]`;
        case iconMediumTemplate:
            return `[[icon:${selectedText}|medium]]`;
        case iconLargeTemplate:
            return `[[icon:${selectedText}|large]]`;
        case '„':
        case '”':
            return `„${selectedText}”`;
        case '«':
        case '»':
            return `«${selectedText}»`;
        default:
            return template.replace('{}', selectedText);  // Assuming {} is a placeholder for dynamic insertion
    }
}

let subscriptMode = false;
let superscriptMode = false;

function subscript() {
    subscriptMode = !subscriptMode;
    if(subscriptMode == true){
    document.querySelector(".editor-tab.advanced .toolbar-button.li").classList.add("active");
    } else {
        document.querySelector(".editor-tab.advanced .toolbar-button.li").classList.remove("active");
    }
    if (subscriptMode && superscriptMode) {
        superscript();
    }
}

function superscript() {
    superscriptMode = !superscriptMode;
    if(superscriptMode == true){
    document.querySelector(".editor-tab.advanced .toolbar-button.ui").classList.add("active");
    } else {
        document.querySelector(".editor-tab.advanced .toolbar-button.ui").classList.remove("active");
    }
    if (superscriptMode && subscriptMode) {
        subscript();
    }
}

const subscriptMap = {
    '0': '₀', '1': '₁', '2': '₂', '3': '₃', '4': '₄',
    '5': '₅', '6': '₆', '7': '₇', '8': '₈', '9': '₉'
};

const superscriptMap = {
    '0': '⁰', '1': '¹', '2': '²', '3': '³', '4': '⁴',
    '5': '⁵', '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹'
};

document.addEventListener('keypress', function(event) {
    const key = event.key;
    
    if ((subscriptMode || superscriptMode) && key >= '0' && key <= '9') {
        event.preventDefault();
        
        let subscriptChar, superscriptChar;
        if (subscriptMode) {
            subscriptChar = subscriptMap[key];
        }
        if (superscriptMode) {
            superscriptChar = superscriptMap[key];
        }

        const textarea = event.target;
        if (textarea instanceof HTMLInputElement || textarea instanceof HTMLTextAreaElement) {
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const value = textarea.value;

            let modifiedValue;
            if (subscriptChar) {
                modifiedValue = value.slice(0, startPos) + subscriptChar + value.slice(endPos);
            } else if (superscriptChar) {
                modifiedValue = value.slice(0, startPos) + superscriptChar + value.slice(endPos);
            }

            if (modifiedValue !== undefined) {
                textarea.value = modifiedValue;
                textarea.setSelectionRange(startPos + 1, startPos + 1);
            }
        }
    }
});

function debounce(func, wait) {
    let timeout;
    return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

textarea.addEventListener('input', debounce(updatePreview, 2000));

function convertToHTML(text) {
    text = text
        .replace(/^= (.+?) =\s*$/gm, '<h1>$1</h1>')
        .replace(/^== (.+?) ==\s*$/gm, '<h2>$1</h2>')
        .replace(/'''(.+?)'''/g, '<b>$1</b>')
        .replace(/''(.+?)''/g, '<i>$1</i>');

    text = text.replace(/^\* (.+)$/gm, '<li>$1</li>');

    text = text.replace(/(<li>.+?<\/li>\n?)+/g, function (match) {
        return '<ul>' + match.trim() + '</ul>';
    });

    text = text.replace(/^# (.+)$/gm, '<li>$1</li>');

    text = text.replace(/(<li>.+?<\/li>\n?)+/g, function (match) {
        return '<ol>' + match.trim() + '</ol>';
    });

    text = text.replace('<ul><ol>', '<ul>').replace('</ol></ul>', '</ul>');

    text = text.replace(/\[\[timg:(.+?)\|(.+?)\]\]/g, (match, link, description) => {
        return `<img src="${link}" data-description="${description}">`;
    });

    text = text.replace(/\((https?:\/\/[^\s]+?)\)\[([^\]]+?)\]/g, '<a href="$1">$2</a>');

    text = text.replace(/\[\[img:(.+?)\|(.+?)\|(.+?)\]\]/g, (match, p1, p2, p3) => {
        const alignment = p2 === 'left' || p2 === 'right' ? p2 : '';
        return `<figure class="${alignment}"><img src="${p1}" alt="${p3}"/><figcaption>${p3}</figcaption></figure>`;
    });

    text = text.replace(/\{\|([\s\S]+?)\|\}/g, (match, content) => {
        if (content.startsWith('infobox')) {
            let caption = content.match(/infobox (.+)/)[1].trim();
            let tableHTML = `<table class="infobox"><caption>${caption}</caption><tbody>`;
            let lines = content.trim().split('\n');

            let inIboxSection = false;
            let iboxHTML = '';

            for (let line of lines) {
                line = line.trim();

                if (inIboxSection) {
                    if (line.startsWith('}|')) {
                        inIboxSection = false;
                        iboxHTML += '</tbody></table>';
                        tableHTML += `<tr><td colspan="2">${iboxHTML}</td></tr>`;
                        iboxHTML = '';
                    } else if (line.startsWith('|')) {
                        iboxHTML += '<tr>';
                        let cells = line.split('||');
                        for (let cell of cells) {
                            iboxHTML += `<td>${cell.trim().replace(/^\||\|$/g, '')}</td>`;
                        }
                        iboxHTML += '</tr>';
                    }
                } else if (line.startsWith('|{ibox')) {
                    inIboxSection = true;
                    iboxHTML += '<table class="ibox"><tbody>';
                } else if (line.startsWith('!')) {
                    tableHTML += '<tr>';
                    let segments = line.split('!');
                    for (let segment of segments) {
                        if (segment.trim() !== '') {
                            if (segment.trim().startsWith('|')) {
                                let cells = segment.trim().split('||');
                                for (let cell of cells) {
                                    tableHTML += `<td>${cell.trim().replace(/^\||\|$/g, '')}</td>`;
                                }
                            } else {
                                tableHTML += `<th>${segment.trim()}</th>`;
                            }
                        }
                    }
                    tableHTML += '</tr>';
                } else if (line.startsWith('|')) {
                    tableHTML += '<tr>';
                    let cells = line.split('||');
                    for (let cell of cells) {
                        tableHTML += `<td>${cell.trim().replace(/^\||\|$/g, '')}</td>`;
                    }
                    tableHTML += '</tr>';
                }
            }

            tableHTML += '</tbody></table>';
            return tableHTML;
        } else {
            let lines = content.trim().split('\n');
            let tableHTML = '<table>';

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('!')) {
                    tableHTML += '<tr>';
                    let segments = line.split('!');
                    for (let segment of segments) {
                        if (segment.trim() !== '') {
                            if (segment.trim().startsWith('|')) {
                                let cells = segment.trim().split('||');
                                for (let cell of cells) {
                                    tableHTML += `<td>${cell.trim().replace(/^\||\|$/g, '')}</td>`;
                                }
                            } else {
                                tableHTML += `<th>${segment.trim()}</th>`;
                            }
                        }
                    }
                    tableHTML += '</tr>';
                } else if (line.startsWith('|')) {
                    tableHTML += '<tr>';
                    let cells = line.split('||');
                    for (let cell of cells) {
                        tableHTML += `<td>${cell.trim().replace(/^\||\|$/g, '')} </td>`;
                    }
                    tableHTML += '</tr>';
                }
            }

            tableHTML += '</table>';
            return tableHTML;
        }
    });
    
    text = text.replace(/>t=rv=t/g, ' style="text-align: right; vertical-align: top;" >');
    text = text.replace(/>t=cv=t/g, ' style="text-align: center; vertical-align: top;" >');
    text = text.replace(/>t=rv=b/g, ' style="text-align: right; vertical-align: bottom;" >');
    text = text.replace(/>t=cv=b/g, ' style="text-align: center; vertical-align: bottom;" >');
    text = text.replace(/>t=c/g, ' style="text-align: center;" >');
    text = text.replace(/>t=r/g, ' style="text-align: right;" >');
    text = text.replace(/>v=t/g, ' style="vertical-align: top;" >');
    text = text.replace(/>v=b/g, ' style="vertical-align: bottom;" >');
    text = text.replace(/>r=(\d+)/g, ' rowspan="$1" >');
    text = text.replace(/>c=(\d+)/g, ' colspan="$1" >');
    text = text.replace(/>b=(\w+)/g, ' class="cell-background-color-$1">');
    
    text = text.replace(/\[\[icon:(https?:\/\/.+?)\|(\w+)\]\]/g, '<img src="$1" class="icon $2"/>');
    
    text = text.split('\n').map(line => {
        if (line.trim() === '' || /<(?!\/?(i|a|b|img)\b)[a-z][\s\S]*>/i.test(line.trim())) {
            return line;
        }
        return `<p>${line.trim()}</p>`;
    }).join('\n');
    
    text = text.replace(/<p>\s*<\/p>/g, '');
        
        text = text.trim();
        
        text = text.replace(/<ul>\s*<ol>/gi, '<ul>');
        text = text.replace(/<\/ol>\s*<\/ul>/gi, '</ul>');

    return text;
}
function updatePreview() {
    const text = `<header><div>${document.getElementById("article-title").value}</div><span>${document.getElementById("article-date").value}</span></header>\n` + textarea.value;
    const convertedHTML = convertToHTML(text);
    const loading = document.createElement("div");
    document.getElementById("preview-loading-container").appendChild(loading);
    setTimeout(function(){
        article.innerHTML = convertedHTML;
        validateDictionaryIncluding();  
        if(includeDictionary == true){
            document.querySelector('article table.infobox tbody').innerHTML += '<tr><td colspan="2" style="border-top: 1px solid #a2a9b1;"><table class="ibox"><tbody><tr class="plainlink"><td><img src="https://i.ibb.co/XJQSsqS/slownik.png"></td><td><span class="modal-opener" id="dictionary-opener">Hasło w słowniku</span></td></tr></tbody></table></td></tr>';
        }
        wrapTables();
    }, 750);
    setTimeout(function(){
        document.getElementById("preview-loading-container").innerHTML = '';
    }, 850)
}
window.addEventListener('beforeunload', function (e) {
    e.preventDefault();
    e.returnValue = '';
    const confirmationMessage = 'Are you sure you want to leave?';
    if (e) {
        e.returnValue = confirmationMessage;
    }
    return confirmationMessage;
});

document.getElementById('save-article').addEventListener('click', copyArticleToClipboard);

function copyArticleToClipboard() {
    updatePreview();
    setTimeout(function(){
    const articleTitle = document.getElementById("article-title").value;
    const articleParagraphs = Array.from(document.querySelectorAll('#preview-container article p'));
let articleDescription = '';
let i = 0;

while (i < articleParagraphs.length && (articleDescription.length < 350 || articleDescription.length > 400)) {
    if (articleDescription) {
        articleDescription += ' ';
    }
    articleDescription += articleParagraphs[i].textContent.trim();
    i++;
}

if (articleDescription.length > 400) {
    articleDescription = articleDescription.substring(0, 400);
}

function setMetaImageProperties(image) {
return `<meta property="og:image" content="${image.src}">
<meta name="twitter:image" content="${image.src}">
<meta property="og:image:width" content="${image.naturalWidth}">
<meta property="og:image:height" content="${image.naturalHeight}">`;
}

let articleMetaImageProperties = '';

if (document.querySelector('article table.infobox img:not(.icon)')) {
    articleMetaImageProperties = setMetaImageProperties(document.querySelector('article table.infobox img:not(.icon)'));
} else if (document.querySelector('article img:not(.icon)')) {
    articleMetaImageProperties = setMetaImageProperties(document.querySelector('article img:not(.icon)'));
}

    const el = document.createElement('textarea');
    const pageheaderScript = '<script src="/fangea/pageheader.js"></' + 'script>';
    const articleScript = '<script src="/fangea/article.js"></' + 'script>';
    const fontAwesomeScript = '<script src="https://kit.fontawesome.com/533593bc84.js" crossorigin="anonymous"></' + 'script>';
    var dictionaryScript = '';
    validateDictionaryIncluding();
    var dictionaryInfo = gatherDictionaryInfo();

    if (includeDictionary == true){
    dictionaryScript = `<script>
const dictionaryhtml = \`<h1>${articleTitle}</h1>\n${dictionaryInfo}\`;
createModalWindow('dictionary', dictionaryhtml);
setModalOpener('dictionary', 'dictionary-opener');
</` + 'script>'; 
    }


el.value = `<html lang="pl">
<head>
<link rel="icon" href="/fangea/local/fangeapage.png" type="image/png">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>${articleTitle} - Fangea i inne kontynenty</title>
<meta property="og:title" content="${articleTitle}">
<meta name="twitter:title" content="${articleTitle}">
<meta name="description" content="${articleDescription}">
<meta property="og:description" content="${articleDescription}">
<meta name="twitter:description" content="${articleDescription}">
${articleMetaImageProperties}
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Geologica:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/fangea/style.css" />
${fontAwesomeScript}
</head>
<body>
<header id="pageheader">
</header>
<main>
<nav>
<h1>Spis Treści</h1>
<ul></ul>
</nav>
<article>\n${document.querySelector("#preview-container article").innerHTML}\n <div id="source-code" style="display:none;">${textarea.value}</div>\n</article>
</main>
${pageheaderScript}
${articleScript}
${dictionaryScript}
</body>
</html>`;
    
    el.style.position = 'absolute';
    el.style.left = '-9999px';

    document.body.appendChild(el);
    
    const selected =
        document.getSelection().rangeCount > 0 ? document.getSelection().getRangeAt(0) : false;
    
    el.select();
    
    document.execCommand('copy');
    
    document.body.removeChild(el);
    
    if (selected) {
        document.getSelection().removeAllRanges();
        document.getSelection().addRange(selected);
    }
    document.getElementById('save-article').innerHTML = `<i class="fa-solid fa-check" aria-hidden="true"></i> Skopiowano artykuł`;
    setTimeout(function(){
        document.getElementById('save-article').innerHTML = `<i class="fa-solid fa-clipboard" aria-hidden="true"></i> Skopiuj do schowka`;
    }, 1500)
}, 850);
}

    var isPreviewHidden = false;
    document.getElementById("switch-preview").addEventListener("click", switchPreview);

    function switchPreview(){
    if(isPreviewHidden == false){
    document.getElementById("editor-container").classList.add('full');
    document.getElementById("preview-container").classList.add('hidden');
    document.getElementById("switch-preview").innerHTML = '<i class="fa-solid fa-eye" aria-hidden="true"></i>Pokaż podgląd';
    isPreviewHidden = true;
    } else {
    document.getElementById("editor-container").classList.remove('full');
    document.getElementById("preview-container").classList.remove('hidden');
    document.getElementById("switch-preview").innerHTML = '<i class="fa-solid fa-eye-slash" aria-hidden="true"></i>Ukryj podgląd';
    isPreviewHidden = false;
    }
    
}
    function showModal(id){
document.getElementById("modal-container").classList.add("active");
document.getElementById(id).classList.add("active"); 
}
function hideModal(id) {
  document.getElementById("modal-container").classList.add("hidden");
  setTimeout(function() {
      document.getElementById("modal-container").classList.remove("active");
      document.getElementById("modal-container").classList.remove("hidden");
      if (id !== 'any') {
          document.getElementById(id).classList.remove("active");
      } else {
          Array.from(document.getElementById("modal-container").querySelectorAll(".modal")).forEach(modal => {
              modal.classList.remove("active");
          });
      }
  }, 250);
}

function setModalOpener(modalId, openerId){
document.getElementById(openerId).addEventListener("click", () => showModal(modalId));
}
function createModalWindow(id, innerhtml){
  var modal = document.createElement("div");
  modal.classList.add("modal");
  modal.id = id;
  modal.innerHTML = '<i class="fa-solid fa-xmark modal-close"></i>' + innerhtml;
  document.getElementById("modal-container").appendChild(modal);

  // Fix: pass the hideModal function as a reference, not invoke it immediately
  document.getElementById(id).querySelector('.modal-close').addEventListener("click", () => hideModal(id));
  document.getElementById("modal-overlay").addEventListener("click", () => hideModal('any'));
}
    // Get all tab elements
    const tabElements = document.querySelectorAll('#dictionary-tab-bar > div');

    // Add click event listener to each tab
    tabElements.forEach(tabElement => {
        tabElement.addEventListener('click', () => {
            const tabName = tabElement.getAttribute('data-tab');

            // Remove 'active' class from all tabs and content areas
            tabElements.forEach(tab => {
                tab.classList.remove('active');
                document.getElementById(tab.getAttribute('data-tab')).classList.remove('active');
            });

            // Add 'active' class to the clicked tab and its content area
            tabElement.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        });
    });
    document.addEventListener('DOMContentLoaded', function() {
      const listContainer = document.querySelector('.list-type-input-list');

      // Function to create a new input container
      function createInputContainer() {
        const newContainer = document.createElement('div');
        newContainer.classList.add('list-type-input-container');

        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.classList.add('list-type-input');

        newInput.addEventListener('input', handleInput);

        newContainer.appendChild(newInput);
        listContainer.appendChild(newContainer);
      }

      // Function to handle input events
      function handleInput(event) {
        const currentInput = event.target;
        const currentContainer = currentInput.parentElement;
        const allInputs = listContainer.querySelectorAll('.list-type-input');

        // If current input is the last one and has text, create a new input container
        if (currentInput.value !== '' && currentContainer === listContainer.lastElementChild) {
          createInputContainer();
        }

        // Remove empty input fields if they are not the last input
        if (currentInput.value === '' && currentContainer !== listContainer.lastElementChild) {
          currentContainer.remove();
        }

        // Ensure the last input container is always empty
        const lastInput = listContainer.lastElementChild.querySelector('.list-type-input');
        if (lastInput.value !== '') {
          createInputContainer();
        }
      }

      // Attach input event listener to the first input
      const firstInput = listContainer.querySelector('.list-type-input');
      firstInput.addEventListener('input', handleInput);

    const listContainers = document.querySelectorAll('.list-type-input-list');

// Function to create a new input container
function createInputContainer(listContainer) {
  const newContainer = document.createElement('div');
  newContainer.classList.add('list-type-input-container');

  const newInput = document.createElement('input');
  newInput.type = 'text';
  newInput.classList.add('list-type-input');

  newInput.addEventListener('input', (event) => handleInput(event, listContainer));

  newContainer.appendChild(newInput);
  listContainer.appendChild(newContainer);
}

// Function to handle input events
function handleInput(event, listContainer) {
  const currentInput = event.target;
  const currentContainer = currentInput.parentElement;
  const allInputs = listContainer.querySelectorAll('.list-type-input');

  // If current input is the last one and has text, create a new input container
  if (currentInput.value !== '' && currentContainer === listContainer.lastElementChild) {
    createInputContainer(listContainer);
  }

  // Remove empty input fields if they are not the last input
  if (currentInput.value === '' && currentContainer !== listContainer.lastElementChild) {
    currentContainer.remove();
  }

  // Ensure the last input container is always empty
  const lastInput = listContainer.lastElementChild.querySelector('.list-type-input');
  if (lastInput.value !== '') {
    createInputContainer(listContainer);
  }
}

// Attach input event listeners to the initial inputs
listContainers.forEach(listContainer => {
  const firstInput = listContainer.querySelector('.list-type-input');
  firstInput.addEventListener('input', (event) => handleInput(event, listContainer));
});
});

    const inflectionTable = document.querySelector('.inflection-table');
    const inflectionCells = document.querySelectorAll('.inflection-lm');
    const inflectionInputs = document.querySelectorAll('.inflection-lm input');

    function checkInputs() {
        for (let input of inflectionInputs) {
            if (input.value.trim() !== '') {
                inflectionTable.classList.add('lm-included');
                return;
            }
        }
        inflectionTable.classList.remove('lm-included');
    }

    function handleMouseEnter() {
        inflectionTable.classList.add('lm-included');
    }

    function handleMouseLeave() {
        checkInputs();
    }

    inflectionCells.forEach(cell => {
        cell.addEventListener('mouseenter', handleMouseEnter);
        cell.addEventListener('mouseleave', handleMouseLeave);
    });

    inflectionInputs.forEach(input => {
        input.addEventListener('input', checkInputs);
    });

    checkInputs();

    document.getElementById("include-dictionary").addEventListener('change', validateDictionaryIncluding)

    function validateDictionaryIncluding(){
    const checkbox = document.getElementById("include-dictionary");

        if(checkbox.checked == true){
            if(document.querySelector('#preview-container article .infobox')){
            document.getElementById('dictionary-setup').classList.remove("hidden");
                includeDictionary = true;
            } else{
                document.getElementById('dictionary-setup').classList.add("hidden");
                document.getElementById('dictionary-error-message').innerHTML = 'Musisz utworzyć tabelę infobox.'
                setTimeout(function(){
                    document.getElementById('dictionary-error-message').innerHTML = '';
                }, 2000)
                includeDictionary = false;
                checkbox.checked = false;
            }
        } else{
            document.getElementById('dictionary-setup').classList.add("hidden");
            includeDictionary = false;
        }

    }

    function gatherDictionaryInfo() {

    var dictionaryInfo = '';

    if (includeDictionary == true){
    var pronunciation = '';
    var meanings = '';
    var inflection = '';
    var related = '';
    var translation = '';
    var etymology = '';

    if (document.querySelector('#pronunciation input').value.length > 0) {
        pronunciation = `<h2>wymowa</h2>\n<p>${document.querySelector('#pronunciation input').value}</p>`;
    }

    if (document.querySelector('#meanings input').value.length > 0) {
        var meaningsTemp = [];
        Array.from(document.querySelectorAll('#meanings input')).forEach(element => {
            if (element.value.length > 0) {
                meaningsTemp.push(`<li>${element.value}</li>\n`);
            }
        });
        meanings = `\n<h2>znaczenia</h2>\n<ul>\n${meaningsTemp.join('')}</ul>`;
    }

    // Check inputs for inflection table
    const lpInputs = document.querySelectorAll('input[id$="-lp"]');
    const lmInputs = document.querySelectorAll('input[id$="-lm"]');

    const allInputsFilled = (inputs) => {
        for (let input of inputs) {
            if (input.value.trim() === '') {
                return false;
            }
        }
        return true;
    };

    const lpFilled = allInputsFilled(lpInputs);
    const lmFilled = allInputsFilled(lmInputs);

    if (lpFilled || lmFilled) {
        let tableHeaders = `\n<tr><th>przypadek</th>`;
        let tableRows = '';

        if (lpFilled) {
            tableHeaders += `<th>liczba pojedyncza</th>`;
        }
        if (lmFilled) {
            tableHeaders += `<th>liczba mnoga</th>`;
        }
        tableHeaders += `</tr>`;

        const cases = ['mianownik', 'dopelniacz', 'celownik', 'biernik', 'narzednik', 'miejscownik', 'wolacz'];

        cases.forEach(caseName => {
            let row = `\n<tr><th>${caseName}</th>`;
            if (lpFilled) {
                row += `<td>${document.getElementById(caseName + '-lp').value}</td>`;
            }
            if (lmFilled) {
                row += `<td>${document.getElementById(caseName + '-lm').value}</td>`;
            }
            row += `</tr>`;
            tableRows += row;
        });

        inflection = `\n<h2>odmiana</h2>\n<table>\n<tbody>${tableHeaders}${tableRows}\n</tbody>\n</table>`;
    }

    if (document.querySelector('#related input').value.length > 0) {
        var relatedTemp = [];
        Array.from(document.querySelectorAll('#related input')).forEach(element => {
            if (element.value.length > 0) {
                relatedTemp.push(`<li>${element.value}</li>\n`);
            }
        });
        related = `\n<h2>wyrazy pokrewne</h2>\n<ul>\n${relatedTemp.join('')}</ul>`;
    }
    
    if (document.querySelector('#translation input').value.length > 0) {
        var translationTemp = [];
        Array.from(document.querySelectorAll('#translation input')).forEach(element => {
            if (element.value.length > 0) {
                translationTemp.push(`<li>${element.value}</li>\n`);
            }
        });
        translation= `\n<h2>tłumaczenia</h2>\n<ul>\n${translationTemp.join('')}</ul>`;
    }

    if (document.querySelector('#etymology textarea').value.length > 0) {
        etymology = `\n<h2>etymologia</h2>\n<p>${document.querySelector('#etymology textarea').value}</p>`;
    }


    // Combine all sections into a single dictionary information string
    dictionaryInfo = pronunciation + meanings + inflection + related + translation + etymology;

    dictionaryInfo = dictionaryInfo.replace(/'''(.+?)'''/g, '<b>$1</b>').replace(/''(.+?)''/g, '<i>$1</i>');

    }
    return dictionaryInfo;
}
let canUpdate = true;

document.getElementById('update-preview-button').addEventListener('click', function() {
    if (canUpdate) {
        updatePreview();
        canUpdate = false;
        setTimeout(function() {
            canUpdate = true;
        }, 1000); // 1000 milliseconds cooldown
    }
});

    function wrapTables(){
    const articleTables = Array.from(document.querySelectorAll("article table:not(.infobox, .ibox)"));
    articleTables.forEach(table => {
  // Check if the table is already wrapped
  if (!table.closest('.table-wrapper')) {
    const wrapper = document.createElement('div');
    wrapper.classList.add('table-wrapper'); // Optional: Add a class to the div for styling
    table.parentNode.insertBefore(wrapper, table); // Insert the <div> before the table
    wrapper.appendChild(table); // Append the table inside the <div>
  }
});
}


    </script>
</body>

</html>
